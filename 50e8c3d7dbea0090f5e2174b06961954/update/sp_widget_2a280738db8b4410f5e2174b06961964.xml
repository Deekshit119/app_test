<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function(spModal, $scope, $rootScope, $location, $timeout, spUtil, spAriaFocusManager, $uibModalStack) {
//function(spModal, spAriaUtil, $scope, $rootScope, $location, $timeout, spUtil, spAriaFocusManager, $uibModalStack, nowAttachmentHandler) {
  var c = this;
	
	var IsuserID = (c.data.uId == '8a21e682dbb6ff80bbe25c88f4961984');
	$scope.errorMessages = [];

	$scope.setchanged = 'false';
	c.data.setchanged = 'false';
	$scope.expline_sysid = c.data.expline_sysid;
	$scope.valCodeloga = c.data.codeloga[0].code;
	
	var year= c.data.date.substr(6, 4);
	var month= c.data.date.substr(3, 2);
	var day= c.data.date.substr(0, 2);
	$scope.expDate = new Date(year,month-1,day);
	
	$scope.location_from = {
	displayValue: c.data.items[0].expline_location,
	value: c.data.LocationFromId,
	name: 'location_from'
	};
	
	$scope.location_to = {
	displayValue: c.data.items[0].expline_travelkm,
	value: c.data.LocationToId,
	name: 'location_to'
	};
	
	$scope.Rubric = {
	displayValue: c.data.items[0].expline_rubric,
	value: c.data.RubricId,
	name: 'Rubric'
	};
	
	$scope.expOpenBy = '' || c.data.items[0].expsheet_opened_by;
	$scope.expReqFor = '' || c.data.items[0].expsheet_requested_for;
	$scope.expContract = '' || c.data.items[0].expsheet_contract;
	$scope.expDesc = '' || c.data.items[0].expsheet_short_description;
	$scope.expAmount = parseFloat(c.data.items[1].expline_requested_amount).toFixed(2);
	$scope.expOtherLoc = '' || c.data.items[0].expline_other_location;
	
	$scope.$on("field.change", function(evt, parms) {
		$scope.SetChangeTrue();
	});	
	
	function Control() {
		if (IsuserID) {

			//console.log('scope.expOtherLoc:'+$scope.expOtherLoc);
		}
		if(c.data.codeloga[0].code=='79C' || c.data.codeloga[0].code=='79H') {
				if($scope.location_from.value != '' && $scope.location_from.value != null && $scope.location_to.value != null && $scope.location_to.value != '' ){ //&& (document.getElementById('expOtherLoc').value == '')){
					if($scope.Rubric.value == 'fbc37b13dbee0090f5e2174b06961948' || $scope.Rubric.value == 'f7b2f22bdb3fcc50011e177e16961981')
						document.getElementById('expOtherLoc').value = '';
						
					document.getElementById('expReqValue').readOnly = true;
					document.getElementById('labelReqValue').style.color = 'black';
					document.getElementById('labelOtherLoc').style.color = 'black';
					document.getElementById('labelLocFrom').style.color = 'black';
					document.getElementById('labelLocTo').style.color = 'black';
					$scope.setchanged = 'getNbKm';
					c.data.setchanged = 'getNbKm';
					c.data.location_from = $scope.location_from;
					c.data.location_to = $scope.location_to;
					c.server.update().then(function(data){
					if(data.retour_action=='KMKO') {
						spModal.open({
							title: '${expense.modal.warning}',
							message: "${expense.invalid_from_to_location}",
							buttons: [
								{label:'OK', primary: true}
							],
							backdrop: 'static'
						}).then(function() {
								// true or false
								c.data.location_to.value = null;
								c.data.setchanged = 'false';
								$scope.setchanged = 'false';
								Control();
							});
						}
						else {
								c.data.expline_requested_value = data.expline_requested_value;
								$scope.setchanged = 'true';
								c.data.setchanged = 'true';
							}
					});
					spUtil.update($scope);
			}
				else {
					if($scope.Rubric.value != 'fbc37b13dbee0090f5e2174b06961948' && $scope.Rubric.value != 'f7b2f22bdb3fcc50011e177e16961981') document.getElementById('expOtherLoc').readOnly = false;
					document.getElementById('expReqValue').readOnly = false;
					if(($scope.location_from.value == '' || $scope.location_from.value == null) && ($scope.location_to.value == null || $scope.location_to.value == ''))// && (document.getElementById('expOtherLoc').value == ''))
					{
						//document.getElementById('labelOtherLoc').style.color = 'red';
						document.getElementById('labelLocFrom').style.color = 'red';
						document.getElementById('labelLocTo').style.color = 'red';
						document.getElementById('labelReqValue').style.color = 'red';
						c.data.setchanged = 'invalid';
						$scope.setchanged = 'invalid';
					}
					else if(($scope.location_from.value == '' || $scope.location_from.value == null) && ($scope.location_to.value == null || $scope.location_to.value == ''))// && (document.getElementById('expOtherLoc').value != ''))
					{
						if($scope.Rubric.value != 'fbc37b13dbee0090f5e2174b06961948' && $scope.Rubric.value != 'f7b2f22bdb3fcc50011e177e16961981') document.getElementById('labelOtherLoc').style.color = 'black';
						document.getElementById('labelLocFrom').style.color = 'black';
						document.getElementById('labelLocTo').style.color = 'black';
						document.getElementById('expReqValue').readOnly = false;
						c.data.setchanged = 'invalid';
						$scope.setchanged = 'invalid';
					}
					else if(($scope.location_from.value != '' && $scope.location_from.value != null) && ($scope.location_to.value == null || $scope.location_to.value == ''))// && (document.getElementById('expOtherLoc').value == ''))
					{
						if($scope.Rubric.value != 'fbc37b13dbee0090f5e2174b06961948' && $scope.Rubric.value != 'f7b2f22bdb3fcc50011e177e16961981') document.getElementById('labelOtherLoc').style.color = 'red';
						document.getElementById('labelLocFrom').style.color = 'black';
						document.getElementById('labelLocTo').style.color = 'red';
						document.getElementById('expReqValue').readOnly = false;
						c.data.setchanged = 'invalid';
						$scope.setchanged = 'invalid';
					}
					else if(($scope.location_to.value != '' && $scope.location_to.value != null) && ($scope.location_from.value == null || $scope.location_from.value == ''))// && (document.getElementById('expOtherLoc').value == ''))
					{
						if($scope.Rubric.value != 'fbc37b13dbee0090f5e2174b06961948' && $scope.Rubric.value != 'f7b2f22bdb3fcc50011e177e16961981') document.getElementById('labelOtherLoc').style.color = 'red';
						document.getElementById('labelLocFrom').style.color = 'red';
						document.getElementById('labelLocTo').style.color = 'black';
						document.getElementById('expReqValue').readOnly = false;
						c.data.setchanged = 'invalid';
						$scope.setchanged = 'invalid';
					}
					
					if(document.getElementById('expReqValue').value == 0 || document.getElementById('expReqValue').value=='' || document.getElementById('expReqValue').value == null) {
						document.getElementById('labelReqValue').style.color = 'red';
						c.data.setchanged = 'invalid';
						$scope.setchanged = 'invalid';
					}
					else {
						document.getElementById('labelReqValue').style.color = 'black';
					}
				}

				// If field expOtherLoc (Autre Lieu) filled :
				// 1. set location_from & location_to fields to read only
				// 2. set value to '' ?
			
				if(document.getElementById('expOtherLoc').value != '' && $scope.Rubric.value != 'fbc37b13dbee0090f5e2174b06961948' && $scope.Rubric.value != 'f7b2f22bdb3fcc50011e177e16961981') {
					c.data.setchanged = 'true';
					$scope.setchanged = 'true';
					$scope.location_to.value = null;
					document.getElementById('location_from').readOnly = false;
					document.getElementById('location_to').readOnly = true;
					document.getElementById('expReqValue').readOnly = false;
					if(document.getElementById('labelReqValue').value!='') document.getElementById('labelReqValue').style.color = 'black'; else document.getElementById('labelReqValue').style.color = 'red';
					if(document.getElementById('expOtherLoc').value!='') document.getElementById('labelOtherLoc').style.color = 'black'; else document.getElementById('labelOtherLoc').style.color = 'red';
					if(document.getElementById('labelLocFrom').value!='') document.getElementById('labelLocFrom').style.color = 'black'; else document.getElementById('labelLocFrom').style.color = 'red';
					document.getElementById('labelLocTo').style.color = 'black';
				}
				else {
					document.getElementById('location_from').readOnly = false;
					document.getElementById('location_to').readOnly = false;
				}
		}
		
		if (c.data.codeloga[0].code=='800' && $scope.Rubric.value == 'fbc37b13dbee0090f5e2174b06961949') { //Rubrique Loga Frais de repas dans le canton
			 var iMontantIn = 0;
				var boolMontantInNaN = isNaN(parseFloat(document.getElementById('expReqAmount').value));
				if(!boolMontantInNaN) {
					iMontantIn = parseFloat(document.getElementById('expReqAmount').value);
				}
				if(iMontantIn > 18 || iMontantIn <= 0){
					spModal.open({
						title: '${expense.modal.warning}',
						message: "${expense.rubric_meal_in.amount.control}",
						buttons: [
							{label:'OK', primary: true}
						],
						backdrop: 'static'
					}).then(function() {
						// true or false
						if(iMontantIn > 18) {
							document.getElementById('expReqAmount').value = 18;
							c.data.setchanged = 'true';
							$scope.setchanged = 'true';
						}
						else if(iMontantIn <=0)  {
							document.getElementById('expReqAmount').value = '';
							c.data.setchanged = 'invalid';
							$scope.setchanged = 'invalid';
						}
						//Control();
					});
				}
			}
		
		if (c.data.codeloga[0].code=='800' && $scope.Rubric.value == 'bfc37b13dbee0090f5e2174b06961949') { //Rubrique Loga Frais de repas hors canton
				var iMontantOut = 0;
				var boolMontantOutNaN = isNaN(parseFloat(document.getElementById('expReqAmount').value));
				if(!boolMontantOutNaN) {
					iMontantOut = parseFloat(document.getElementById('expReqAmount').value);
				}
				if(iMontantOut > 23 || iMontantOut <= 0){
					spModal.open({
						title: '${expense.modal.warning}',
						message: "${expense.rubric_meal_out.amount.control}",
						buttons: [
							{label:'OK', primary: true}
						],
						backdrop: 'static'
					}).then(function() {
						// true or false
						if(iMontantOut > 23) {
							document.getElementById('expReqAmount').value = 23;
							c.data.setchanged = 'true';
							$scope.setchanged = 'true';
						}
						else if(iMontantOut <=0)  {
							document.getElementById('expReqAmount').value = '';
							c.data.setchanged = 'invalid';
							$scope.setchanged = 'invalid';
						}
						//Control();
					});
				}
			}
		
		if (c.data.codeloga[0].code=='855') { //Rubrique Connexion Internet
			document.getElementById('expReqAmount').value = 25;
			document.getElementById('expReqAmount').readOnly = true;
			c.data.setchanged = 'true';
			$scope.setchanged = 'true';
			//Control();
		}
	}
	
	$scope.SetChangeTrue = function () {
		$scope.setchanged = 'true';
		Control();
	};
	
	$scope.buttonSaveExpenseEdit = function () {
		c.data.CodeLogaValeur = c.data.codeloga[0].code;
		console.log(c.data.CodeLogaValeur);
		c.data.expOtherLoc = document.getElementById('expOtherLoc').value;

		c.data.expDesc = document.getElementById('expDesc').value;
		if((c.data.codeloga[0].code=='79C' && $scope.Rubric.value == 'fbc37b13dbee0090f5e2174b06961948') || (c.data.codeloga[0].code=='79H' && $scope.Rubric.value == 'f7b2f22bdb3fcc50011e177e16961981'))  {
			c.data.expReqValue = document.getElementById('expReqValue').value;
			c.data.location_from = $scope.location_from.value;
			c.data.location_to = $scope.location_to.value;
		}
		else if((c.data.codeloga[0].code=='79C' && $scope.Rubric.value != 'fbc37b13dbee0090f5e2174b06961948') || (c.data.codeloga[0].code=='79H' && $scope.Rubric.value != 'f7b2f22bdb3fcc50011e177e16961981')){
			c.data.expReqValue = document.getElementById('expReqValue').value;
			c.data.location_from = $scope.location_from.value;
			c.data.location_to = '';
			$scope.location_to.value='';
		}
		else {
			c.data.expReqAmount = document.getElementById('expReqAmount').value;
		}
		c.data.expDate = $scope.expDate;
		
		if(document.getElementById('setchanged').value == 'invalid') {
						spModal.open({
							title: '${expense.modal.warning}',
							message: "${expense.edit.message.invalid_form}",
							buttons: [
								{label:'OK', primary: true}
							],
							backdrop: 'static'
						}).then(function() {
								// true or false
								c.data.setchanged = 'false';
								$scope.setchanged = 'false';
								Control();
							});
		}
		else {
			$scope.setchanged = 'true';
			c.data.setchanged = 'true';

			c.server.update().then(function(){
				$rootScope.$broadcast('execRefresh', 'saved');
				$uibModalStack.dismissAll();
			});
		}

	};
	
	$scope.buttonCloseExpenseEdit = function () {
		if($scope.setchanged == 'true') {
       c.retConfirm='asking';
        spModal.open({
            title: '${expense.modal.leave}',
            message: "${expense.leave.title_message}",
						backdrop: 'static'
        }).then(function(retConfirm) {
             // true or false
					c.retConfirm=retConfirm;
				  $uibModalStack.dismissAll();
        });
    }
		else $uibModalStack.dismissAll();
	};
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.widget-data-table .clearfix{ 
	display: none; 
} 

.pointer {
    cursor: pointer;
}

.v5001b062d7101200b0b044580e6103eb .sp-list-cell {
    white-space: pre-wrap;
}

.user-profile-tabs { 
  height: 60px; 
   
  .widget-header { 
    padding-bottom: 10px; 
    font-weight: normal; 
    color : $brand-primary;
  } 
 
  .no-padding { 
    padding-left : 0px; 
    text-align: center; 
    cursor: pointer; 
 
  } 
 
  .tab-row { 
    margin-top: 15px; 
  } 
} 
 
.widget-tabs { 
  border-bottom: 1px solid $csm-border-color;
  margin-bottom: 15px; 
} 
.widget-tabs { 
  border-bottom: 1px solid $csm-border-color;
} 

.tr-top {
  border-top: 1px solid #ddd;
}

.th-exp-title {
    color: #b92d33;
    display: inline-block;
}

.td_img {
		width: 20px;
  	height: 20px;
  	display: inline-block;
}

.thead {
    border-bottom: 1px solid #ddd;
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-top: 1px solid #ddd;
}

h4 { 
  padding-left: 0px; 
  margin-bottom: 0px; 
} 
 
h4.selected-tab { 
  /*border-bottom: 2px solid #278EFC; */
  border-bottom: 2px solid $brand-primary; 
  color: $link-color;
} 

.btn_expense {
    display: inline-block;
    margin-bottom: 0;
    font-weight: normal;
    text-align: center;
    vertical-align: middle;
    touch-action: manipulation;
    cursor: pointer;
    background-image: none;
    border: 1px solid transparent;
    white-space: nowrap;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.42857;
    border-radius: 4px;
}

.pull-right_expense {
    float: right;
}

.btn_expense-primary_save {
    color: #ffffff;
    background-color: #5bb914;
    border-color: #508c23;
}
 
.btn_expense-primary_close {
    color: #ffffff;
    background-color: #b92d33;
    border-color: #a4282d;
}
 
.profile-tabs { 
  clear: both; 
  padding-bottom: 15px; 
} 

.td-alignmiddle {
	vertical-align:middle;
}
  
.panel-heading{
 background-color : #b92d33; 
}
.expense-panel-primary {
    border-color: #b92d33;
    width: 1585px;
}

.btn-padding-expense{
  padding-right: 15px; 
}

span.panel-title{
 color: $panel-default-heading-bg;
 /*vertical-align: sub;
  vertical-align: -webkit-baseline-middle;*/
}

.panel-heading &gt; .dropdown .dropdown-toggle {
   color: $panel-primary-text;
   /*padding-bottom: 0px;
   vertical-align: bottom;*/
}

.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>hvs_widget_expense</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>hvs_widget_expense</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
 
	data.uId = gs.getUserID();
	
	if(input) {
		if(input.sys_id && input.setchanged != 'true'  && input.setchanged != 'getNbKm' ) {
			data.valCodeloga='';
			data.items = getCatalogItems();
			data.expline_sysid = input.sys_id;
			data.setchanged = 'false';
		}
	}

	if(input)  {
		if(input.setchanged && input.setchanged=='getNbKm')  {
				var valKm = -1;
				var grTravelKM = new GlideRecord('x_hdvi2_expense_expense_travel_km');

				grTravelKM.addQuery('locations',input.location_from.displayValue);
				grTravelKM.addQuery('to',input.location_to.displayValue);
				grTravelKM.query();

				while (grTravelKM.next()) {
					valKm = parseFloat(grTravelKM.getValue('km'));
				}

				if(valKm==-1 || valKm==0) {
					gs.info('recheche km ');
					var grTravelKM2 = new GlideRecord('x_hdvi2_expense_expense_travel_km');
					grTravelKM2.addQuery('to',input.location_from.displayValue);
					grTravelKM2.addQuery('locations',input.location_to.displayValue);
					grTravelKM2.query();
					while (grTravelKM2.next()) {
						valKm = parseFloat(grTravelKM2.getValue('km'));
					}
				}


				if(valKm != -1 && valKm != 0) {
					data.expline_requested_value = valKm;
					data.retour_action = 'OK';
				}
				else {
					data.expline_requested_value = 0;
					data.retour_action = 'KMKO';
				}
		}
	
		if(input.setchanged && input.setchanged=='true')  {
				var expParent ='';
				var scSubmit = new GlideRecord('x_hdvi2_expense_line');
				scSubmit.addQuery("sys_id",input.expline_sysid);
				scSubmit.query();
				if(scSubmit.next()) {

				var year= input.expDate.substr(0, 4);
				var month= input.expDate.substr(5, 2);
				var day= parseInt(input.expDate.substr(8, 2))+1;
				var dFinalDate = day+'.'+month+'.'+year;

				expParent =scSubmit.expense;
				scSubmit.date_expense=dFinalDate;
				scSubmit.other_location=input.expOtherLoc;
				scSubmit.requested_amount=input.expReqAmount;
				scSubmit.requested_value=input.expReqValue;
				if(input.CodeLogaValeur && input.CodeLogaValeur=='79C'){
					//scSubmit.location=document.getElementById('location_from').value;
					//scSubmit.travelkm=document.getElementById('location_to').value;

					if(typeof(input.location_from)!=='undefined') scSubmit.location=input.location_from;
						else scSubmit.location_from='';
					if(typeof(input.location_to)!=='undefined') scSubmit.travelkm=input.location_to;
						else scSubmit.travelkm='';

				}

					scSubmit.update();
				}

				var scSubExp = new GlideRecord('x_hdvi2_expense_sheet');
				scSubExp.addQuery("sys_id",expParent);
				scSubExp.query();
				if(scSubExp.next()) {
					scSubExp.short_description = input.expDesc;
					scSubExp.update();
				}
		}	
	}
	
	var filterRubric = '';
	
	function getCatalogItems() {
		var sc = new GlideRecord('x_hdvi2_expense_view');
		sc.addQuery('expline_sys_id',input.sys_id);
		sc.query();
		
		var results = [];
		while (sc.next()) {
			if (!$sp.canReadRecord(sc))
				continue;

		var ticketConversationOptions = {};
		ticketConversationOptions.sys_id = sc.getValue('expline_expense');
		ticketConversationOptions.table  = 'x_hdvi2_expense_sheet';
		ticketConversationOptions.record_id = sc.getValue('expline_expense');
		ticketConversationOptions.record_table  = 'x_hdvi2_expense_sheet';
		ticketConversationOptions.readonly = ''+input.read_only;
		ticketConversationOptions.record_only = ''+input.read_only;
		data.Attachment = $sp.getWidget('widget-expense-ticket-attachments', ticketConversationOptions);
		
			var item = {};
			//$sp.getRecordDisplayValues(item, sc, 'expline_sys_id,expsheet_contract,expsheet_number,expline_date_expense,expsheet_short_description,expsheet_opened_by,expsheet_requested_for,expsheet_contract,expline_rubric,expsheet_category,expline_status,expline_requested_amount,expline_requested_value,expline_currency,expline_location,expline_travelkm,expline_other_location,expsheet_category,expline_expense');
			$sp.getRecordDisplayValues(item, sc, 'expline_sys_id,expsheet_contract,expsheet_number,expline_date_expense,expsheet_short_description,expsheet_opened_by,expsheet_requested_for,expsheet_contract,expline_rubric,expsheet_category,expline_status,expline_currency,expline_location,expline_travelkm,expline_other_location,expsheet_category,expline_expense');
			results.push(item);
			$sp.getRecordValues(item, sc, 'expline_requested_amount,expline_requested_value');
			results.push(item);

			data.date=sc.getDisplayValue('expline_date_expense');
			data.expline_requested_value = parseFloat(sc.getValue('expline_requested_value')).toFixed(2);
			data.expline_requested_amount = parseFloat(sc.getValue('expline_requested_amount')).toFixed(2);
			
			var sFilterRubric = sc.getValue('expsheet_category');
			data.CategRubric=sFilterRubric.charAt(0).toUpperCase() + sFilterRubric.slice(1);
			filterRubric ='category=topic^active=true^type='+sFilterRubric.charAt(0).toUpperCase() + sFilterRubric.slice(1)+'^contract_type=';
			
			data.LocationFromId = ''||sc.getValue('expline_location');
			data.LocationToId = ''||sc.getValue('expline_travelkm');
			data.RubricId = ''||sc.getValue('expline_rubric');
		}

		data.codeloga = [];
		var scCodeLoga = new GlideRecord('x_hdvi2_expense_loga_data');
		scCodeLoga.addQuery('sys_id',data.RubricId);
		scCodeLoga.query();
		while (scCodeLoga.next()) {
			var objCode = {};
			data.valCodeloga=scCodeLoga.code;
			$sp.getRecordDisplayValues(objCode, scCodeLoga, 'code,label,sys_id,maximum_amount');
			data.codeloga.push(objCode);
		}
		
		return results;
	}
	
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>h40009222</sys_created_by>
        <sys_created_on>2020-02-16 12:36:48</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>2a280738db8b4410f5e2174b06961964</sys_id>
        <sys_mod_count>1413</sys_mod_count>
        <sys_name>hvs_widget_expense</sys_name>
        <sys_package display_value="Expense Management" source="x_hdvi2_expense">50e8c3d7dbea0090f5e2174b06961954</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Expense Management">50e8c3d7dbea0090f5e2174b06961954</sys_scope>
        <sys_update_name>sp_widget_2a280738db8b4410f5e2174b06961964</sys_update_name>
        <sys_updated_by>h40009222</sys_updated_by>
        <sys_updated_on>2020-04-10 19:23:24</sys_updated_on>
        <template><![CDATA[ <div ng-if="data.uId != 'user_id8a21e682dbb6ff80bbe25c88f4961984'">
 		<sp-widget widget="c.data.Attachment" />
 </div>
<p/>
<div class="panel panel-primary" >
 <div class="panel-heading">${expense.label.modification_detail} : <b>{{c.data.items[0].expsheet_number}}</b></div>
 <div class="panel-primary">
   <table class="table table-striped table-responsive">
     <tr>
       <td class="thead text-nowrap">
      	<label>${expense.label.opened_by} :</label>
     		<input readonly class="form-control" ng-change="SetChangeTrue()" ng-model="expOpenBy" value="{{c.data.items[0].expsheet_expOpenBy}}" type="text">
       </td>
      <td class="thead text-nowrap">
     		<label for="expReqFor">${expense.label.requested_for} :</label>
     		<input readonly class="form-control" ng-change="SetChangeTrue()" ng-model="expReqFor" value="{{c.data.items[0].expsheet_requested_for}}" type="text">
       </td>
     </tr>
     <tr>
       <td class="thead text-nowrap" colspan="2">
      	<label for="expContract">${expense.label.Contract} :</label>
     		<input readonly class="form-control" ng-change="SetChangeTrue()" ng-model="expContract" value="{{c.data.items[0].expsheet_contract}}" type="text">
       </td>
     </tr>
     <tr>
       <td class="thead text-nowrap" colspan="2">
         <label for="expDesc">${expense.label.short_description} :</label>
         <input id="expDesc" class="form-control" ng-change="SetChangeTrue()" ng-model="expDesc" value="{{c.data.items[0].expsheet_short_description}}" type="text">
       </td>
     </tr>
     <tr>
       <td class="thead text-nowrap" colspan="2">
        <label for="expDate">${expense.label.date} : </label>
     		<input class="form-control" placeholder="dd-MM-yyyy" ng-change="SetChangeTrue()" ng-model="expDate" Value="{{data.date}}" id="expDate" type="date">
       </td>
     </tr>
     <tr>
       <td class="thead text-nowrap" colspan=2>
         <div ng-if="data.CategRubric == 'Standard'">
           <label for="Rubric">${expense.label.LogaRubric} :</label>
           <sn-record-picker readonly field="Rubric" table="'x_hdvi2_expense_loga_data'" display-field="'label'" value-field="'sys_id'" search-fields="'label'" page-size="15" default-query="'{{c.data.FilterRubric}}'"></sn-record-picker>
         </div>
         <div ng-if="data.CategRubric == 'Training'">
           <label for="Rubric">${expense.label.LogaRubric} :</label>
           <sn-record-picker readonly field="Rubric" table="'x_hdvi2_expense_loga_data'" display-field="'label'" value-field="'sys_id'" search-fields="'label'" page-size="15" default-query="'{{c.data.FilterRubric}}'"></sn-record-picker>
         </div>
         <div ng-if="data.codeloga[0].code!='79C' && data.codeloga[0].code!='79H'">
           <label style="padding-top:8px;" id="labelReqAmount" for="expReqAmount">${expense.label.RequestedAmount} :</label>
           <input id="expReqAmount" class="form-control" ng-change="SetChangeTrue()" ng-model="expAmount" value="{{data.expline_requested_amount}}" type="text">
         </div>
         <div ng-if="data.codeloga[0].code=='79C' && data.codeloga[0].sys_id=='fbc37b13dbee0090f5e2174b06961948'">
           <label style="padding-top:8px;" id="labelReqValue" for="expReqValue">${expense.label.RequestedValue} :</label>
           <input id="expReqValue" readonly class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" ng-model="expValue" value="{{data.expline_requested_value}}" type="number">
           <label style="padding-top:8px;" id="labelLocFrom" for="location_from">${expense.label.LocationFrom} :</label>
           <sn-record-picker id="location_from" field="location_from" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'locations'" page-size="15" default-query="'km=0'" ></sn-record-picker>
           <label style="padding-top:8px;" id="labelLocTo" for="location_to">${expense.label.LocationTo} :</label>
           <sn-record-picker id="location_to" field="location_to" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'to'" page-size="15" default-query="'km=0'" ></sn-record-picker>
      		 <label style="padding-top:8px;display:none;" id="labelOtherLoc" for="expOtherLoc">${expense.label.OtherLocation} :</label>
     			 <input style="display:none;" readonly class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  
         <div ng-if="data.codeloga[0].code=='79H' && data.codeloga[0].sys_id=='f7b2f22bdb3fcc50011e177e16961981'">
           <label style="padding-top:8px;" id="labelReqValue" for="expReqValue">${expense.label.RequestedValue} :</label>
           <input id="expReqValue" readonly class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" ng-model="expValue" value="{{data.expline_requested_value}}" type="number">
           <label style="padding-top:8px;" id="labelLocFrom" for="location_from">${expense.label.LocationFrom} :</label>
           <sn-record-picker id="location_from" field="location_from" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'locations'" page-size="15" default-query="'km=0'" ></sn-record-picker>
           <label style="padding-top:8px;" id="labelLocTo" for="location_to">${expense.label.LocationTo} :</label>
           <sn-record-picker id="location_to" field="location_to" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'to'" page-size="15" default-query="'km=0'" ></sn-record-picker>
      		 <label style="padding-top:8px;display:none;" id="labelOtherLoc" for="expOtherLoc">${expense.label.OtherLocation} :</label>
     			 <input style="display:none;" readonly class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  

         <div ng-if="data.codeloga[0].code=='79C' && data.codeloga[0].sys_id=='edc49704dbd3c050f5e2174b06961901' && data.items[0].expline_other_location!=''">
           <label style="padding-top:8px;" id="labelReqValue" for="expReqValue">${expense.label.RequestedValue} :</label>
           <input id="expReqValue" class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" ng-model="expValue" value="{{data.expline_requested_value}}" type="number">
           <label style="padding-top:8px;" id="labelLocFrom" for="location_from">${expense.label.LocationFrom} :</label>
           <sn-record-picker id="location_from" field="location_from" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'locations'" page-size="15" default-query="'km=0'" ></sn-record-picker>
           <label style="padding-top:8px;display:none;" id="labelLocTo" for="location_to">${expense.label.LocationTo} :</label>
           <sn-record-picker style="display:none;" id="location_to" field="location_to" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'to'" page-size="15" default-query="'km=0'" ></sn-record-picker>
      		 <label style="padding-top:8px;" id="labelOtherLoc" for="expOtherLoc">${expense.label.Location} :</label>
     			 <input class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  
         <div ng-if="data.codeloga[0].code=='79H' && data.codeloga[0].sys_id=='d7a2f22bdb3fcc50011e177e1696199b' && data.items[0].expline_other_location!=''">
           <label style="padding-top:8px;" id="labelReqValue" for="expReqValue">${expense.label.RequestedValue} :</label>
           <input id="expReqValue" class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" ng-model="expValue" value="{{data.expline_requested_value}}" type="number">
           <label style="padding-top:8px;" id="labelLocFrom" for="location_from">${expense.label.LocationFrom} :</label>
           <sn-record-picker id="location_from" field="location_from" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'locations'" page-size="15" default-query="'km=0'" ></sn-record-picker>
           <label style="padding-top:8px;display:none;" id="labelLocTo" for="location_to">${expense.label.LocationTo} :</label>
           <sn-record-picker style="display:none;" id="location_to" field="location_to" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'to'" page-size="15" default-query="'km=0'" ></sn-record-picker>
      		 <label style="padding-top:8px;" id="labelOtherLoc" for="expOtherLoc">${expense.label.Location} :</label>
     			 <input class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  
         
         <div ng-if="data.codeloga[0].code=='79C' && data.codeloga[0].sys_id=='edc49704dbd3c050f5e2174b06961901' && data.items[0].expline_other_location==''">
           <label style="padding-top:8px;" id="labelReqValue" for="expReqValue">${expense.label.RequestedValue} :</label>
           <input id="expReqValue" class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" ng-model="expValue" value="{{data.expline_requested_value}}" type="number">
           <label style="padding-top:8px;" id="labelLocFrom" for="location_from">${expense.label.LocationFrom} :</label>
           <sn-record-picker id="location_from" field="location_from" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'locations'" page-size="15" default-query="'km=0'" ></sn-record-picker>
           <label style="padding-top:8px;display:none;" id="labelLocTo" for="location_to">${expense.label.LocationTo} :</label>
           <sn-record-picker style="display:none;" id="location_to" field="location_to" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'to'" page-size="15" default-query="'km=0'" ></sn-record-picker>
      		 <label style="padding-top:8px;color:#ff0000;" id="labelOtherLoc" for="expOtherLoc">${expense.label.OtherLocation} :</label>
     			 <input class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  
         <div ng-if="data.codeloga[0].code=='79H' && data.codeloga[0].sys_id=='d7a2f22bdb3fcc50011e177e1696199b' && data.items[0].expline_other_location==''">
           <label style="padding-top:8px;" id="labelReqValue" for="expReqValue">${expense.label.RequestedValue} :</label>
           <input id="expReqValue" class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" ng-model="expValue" value="{{data.expline_requested_value}}" type="number">
           <label style="padding-top:8px;" id="labelLocFrom" for="location_from">${expense.label.LocationFrom} :</label>
           <sn-record-picker id="location_from" field="location_from" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'locations'" page-size="15" default-query="'km=0'" ></sn-record-picker>
           <label style="padding-top:8px;display:none;" id="labelLocTo" for="location_to">${expense.label.LocationTo} :</label>
           <sn-record-picker style="display:none;" id="location_to" field="location_to" table="'x_hdvi2_expense_expense_travel_km'" display-field="'locations'" value-field="'sys_id'" search-fields="'to'" page-size="15" default-query="'km=0'" ></sn-record-picker>
      		 <label style="padding-top:8px;color:#ff0000;" id="labelOtherLoc" for="expOtherLoc">${expense.label.OtherLocation} :</label>
     			 <input class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  
  
         <div style="position:relative;" ng-if="data.codeloga[0].code!='79C' && data.codeloga[0].code!='79H'">
      		<label style="padding-top:8px;" id="labelOtherLoc" for="expOtherLoc">${expense.label.OtherLocation} :</label>
     			<input class="form-control ng-binding ng-scope" ng-change="SetChangeTrue()" id= "expOtherLoc" ng-model="expOtherLoc" value="{{c.data.items[0].other_location}}" type="text">
         </div>  
       </td> 
   </table>

<div>
    <table align="right" style="padding-top:20px; padding-right:0px;">
      <tr><td><span>&nbsp;</span></td></tr>
      <tr> 
       <td>
      	  <label for="close_expline"></label>
          <a id="close_expline" href="javascript:void(0)" ng-click="buttonCloseExpenseEdit()" data-dismiss="modal" class="pull-right_expense btn_expense btn_expense-primary_close">
              ${expense.label.button_close}
          </a>
       </td>
       <td style="width:20px;">
       </td>
       <td>
      	<label for="save_expline"></label>
        <a id="save_expline" href="javascript:void(0)" ng-click="buttonSaveExpenseEdit()" class="pull-right_expense btn_expense btn_expense-primary_save">
            ${expense.label.button_save}
        </a>
       </td>
       <td style="width:20px;">
       </td>
      </tr>
      <tr><td><span>&nbsp;</span></td></tr>
    </table>
 </div>
 </div>
</div>
<div class="pointer ng-binding ng-scope" style="visibility:hidden;">
  <input id="setchanged" ng-model="setchanged" class="ng-binding ng-scope" type="text" >
  <input ng-model="expline_sysid" type="text">
  <input ng-model="valCodeloga" type="text">
</div>


]]></template>
    </sp_widget>
</record_update>
