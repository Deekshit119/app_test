<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function(spModal, $scope, $rootScope, $timeout,$window, snRecordWatcher, $location, spUtil, spAriaFocusManager) {
	var c = this;	
////////////////////////////////////////////////////

	
  var url = window.location.href;
	url = url.toString();
  $scope.setDisplayAppTeam='=1';
	c.data.setDisplayAppTeam='=1';
  c.data.reqExpSheetId='';
	c.data.action='';
  $scope.reqExpSheetId='';
	$scope.action='';
	c.data.comment='undefined';
	$scope.comment='undefined';
	
	
	var skipNextRecordWatchUpdate = true;
	var recordWatcher = snRecordWatcher.initList('x_hdvi2_expense_sheet','active=true');
  c.data.recordWatcher = recordWatcher;
	// console.log(recordWatcher);
	
	$scope.$on('record.updated', function(name, data) {
		spUtil.update($scope);
		//c.server.update();
	});	

	c.refreshScreen=function() {
		c.server.update();
	}

	$scope.findKeywords = function (type,search) {
		var fids = ''+c.data.userId + document.getElementById("selectedFilter").selectedIndex  + document.getElementById("selectedFilterBy").selectedIndex;
		c.data.fids = fids;
		//	$timeout(function() {
				if(type=='rev') {
					if(search) {
						c.data.keywordsRev = search;
						c.data.keywordsType = type;
						
					  c.data.filterField = document.getElementById("selectedFilterBy").selectedIndex;
						
						c.server.update().then(function(data){
						});
					}
					else {
						c.data.keywordsType = '';
						c.server.update();
					}
				}
	//	});
	}
	
	$scope.selectedFilter = c.data.ExpFilter[c.data.selectedIndex];
	$scope.changeFilter = function (selectedFilter) {
		$timeout(function() {
			if(selectedFilter) {
					if(selectedFilter.hasOwnProperty("filter")) {
						var fids = ''+c.data.userId+selectedFilter.index + c.data.selectedIndexField;
						
					c.data.filterField = document.getElementById("selectedFilterBy").selectedIndex;
						
						c.data.fids = fids;
						c.server.update();
					}
		  }
	});
	}
	
		
	$scope.selectedFilterBy = c.data.FilterBy[c.data.selectedIndexField];
	$scope.changeFilterField = function (selectedFilterBy) {
		$timeout(function() {
			if(selectedFilterBy) {
					if(selectedFilterBy.hasOwnProperty("name")) {
						var fids = '' + c.data.userId + c.data.selectedIndex + selectedFilterBy.index;
						c.data.filterField = selectedFilterBy.index;
						c.data.fids = fids;
						c.server.update();
					}
		  }
	});
	}

	
	if(!c.data.isApprover) {
		spModal.open({
			title: '${expense.modal.warning}',
			message: "${You are not authorized to view this page}",
			buttons: [
				{label:'OK', primary: true}
			],
			backdrop: 'static'
		}).then(function() {
			var hosturl = 'https://' + $window.location.host;
			$window.location.href = hosturl + "/exphvs"; 
			});
	}
				
	c.onWidgetOnly = function (explineid,expcategory){
		var widgetExpenseOptionsOnly = {};
		widgetExpenseOptionsOnly.sys_id = explineid;
		widgetExpenseOptionsOnly.read_only = 'true';
		widgetExpenseOptionsOnly.refund_category = expcategory;

		var sSize='';
		if(expcategory.toLowerCase()=='training'){
			sSize = 'lg';
		}
		else {
			sSize = '';
		}
	 
		spModal.open({
			title: '${expense.edit.title_box}',
			widget: '9fb6b106db5f8850f5e2174b069619ae',
			buttons: [],
			backdrop: 'static',
			widgetInput: widgetExpenseOptionsOnly
		}).then(function () {
			  c.data.keywordsType='';
		});
	};
	
	c.SetApprovalExpense = function(reqid,action) {
			if(action=='reject') {
				spModal.open({
				title: '${Reject Request}',
				message: '${approvals.comments.userinfo}',
				input: true,
				backdrop: 'static',
				value: c.comment
				}).then(function(comment) {
						if(comment) {
							$scope.comment=comment;
							c.data.comment=comment;
							$scope.setDisplayAppTeam='=1';
							$scope.reqExpSheetId=reqid;
							c.data.setDisplayAppTeam='=1';
							c.data.reqExpSheetId=reqid;
							c.data.action=action;
							$rootScope.$broadcast('execRefresh', 'rejected');
							c.server.update();
						}
				});
			}
			else if(action=='approve') {
							$scope.comment='.';
							c.data.comment='.';
							$scope.setDisplayAppTeam='=1';
							$scope.reqExpSheetId=reqid;
							c.data.setDisplayAppTeam='=1';
							c.data.reqExpSheetId=reqid;
							c.data.action=action;
							$scope.action=action;
							c.server.update();
							$rootScope.$broadcast('execRefresh', 'approved');
			}
		};
	
		$rootScope.$on('execSubmitted', function(event,data) {
			c.server.update();
  });

	c.server.update();

}]]></client_script>
        <controller_as>c</controller_as>
        <css>.widget-data-table .clearfix{ 
	display: none; 
} 

#reload:hover, #keywordsRev:hover {
  background-color: $brand-primary;
  color: #fff !important;
  opacity : 0.7;
}

#reloadCircle:hover {
  color: $brand-primary !important;
  opacity : 0.7;
}

div select:hover {
  background-color: $brand-primary;
  color: #fff !important;
  opacity : 0.7;
}

.container {
  width: 1597px;
  padding-left: 0px;
  padding-right: 15px;
}

.pointer {
    cursor: pointer;
}

.v5001b062d7101200b0b044580e6103eb .sp-list-cell {
    white-space: pre-wrap;
}

.user-profile-tabs { 
  height: 60px; 
   
  .widget-header { 
    padding-bottom: 10px; 
    font-weight: normal; 
    color : $brand-primary;
  } 
 
  .no-padding { 
    padding-left : 0px; 
    text-align: center; 
    cursor: pointer; 
 
  } 
 
  .tab-row { 
    margin-top: 15px; 
  } 
} 
 
.widget-tabs { 
  border-bottom: 1px solid $csm-border-color;
  margin-bottom: 15px; 
} 
.widget-tabs { 
  border-bottom: 1px solid $csm-border-color;
} 

.tr-top {
  border-top: 1px solid #ddd;
}

.th-exp-title {
    color: $brand-primary; //#b92d33;
    display: inline-block;
}

.td_img {
		width: 20px;
  	height: 20px;
  	display: inline-block;
}

.td_img_send {
		width: 25px;
  	height: 25px;
  	display: inline-block;
}

.thead {
    border-bottom: 1px solid #ddd;
    border-left: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-top: 1px solid #ddd;
}

h4 { 
  padding-left: 0px; 
  margin-bottom: 0px; 
} 
 
h4.selected-tab { 
  /*border-bottom: 2px solid #278EFC; */
  border-bottom: 2px solid $brand-primary; 
  color: $link-color;
} 

 
.profile-tabs { 
  clear: both; 
  padding-bottom: 15px; 
} 

.td-alignmiddle {
	vertical-align:middle;
}
  
.panel-heading{
 background-color : $brand-primary; 
}

select.panel-heading {
  display: block;
  padding: 0px 0px 0px 0px;
  opacity: 1;
  background-color:white;
  color:$text-color;
}

input.panel-heading {
  display: block;
  padding: 0px 0px 0px 0px;
  opacity: 1;
  margin-left:5px;
  //margin-top:-2px;
  background-color:white;
  color:$text-color;
}

.select {
     padding: 0px 0px 0px 10px;
}

.panel{
 margin-bottom : 0px; 
}

span.panel-title{
 color: $panel-default-heading-bg;
 /*vertical-align: sub;
  vertical-align: -webkit-baseline-middle;*/
}

.panel-heading &gt; .dropdown .dropdown-toggle {
   color: $panel-primary-text;
   /*padding-bottom: 0px;
   vertical-align: bottom;*/
}

.expense-panel-primary {
    border-color: $brand-primary; //#b92d33;
    width: 1580px;
}
/*.panel-heading{
  padding: 8px 25px 5px 40px;
}*/


.panel-default&gt;.panel-heading {
  color: #333;
  background-color: $brand-primary; //#b92d33;
  border-color: #e4e5e7;
  padding: 0;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.panel-default&gt;.panel-heading a {
  display: block;
  padding: 10px 15px;
}

.panel-default&gt;.panel-heading a[aria-expanded="true"] {
  background-color: $brand-primary; //#b92d33;
}

a.collapsed:link {
  text-decoration: none;
}

div.collapsed {
  text-decoration: none;
  padding: 10px 15px;
}

.accordion-option {
  width: 100%;
  float: left;
  clear: both;
  margin: 15px 0;
}

.doublon-1 {
	color:#efaa0f;
  font-weight: 600;
}

.doublon-0 {
  color: inherit;
}

i.tip {
    background-color: rgba(237, 241, 242, .95);
    border-radius: 4px;
    text-decoration: none  
}

i.tip:hover {
    cursor: default;
    position: relative
}
i.tip span {
    display: none
}
i.tip:hover span {
  	font-size: 14px;
  	font-family: "SourceSansPro", Helvetica, Arial, sans-serif;
		border: #c0c0c0 1px dotted;
  	box-shadow: 8px 11px 11px 4px rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    padding: 5px 20px 5px 5px;
    color: $brand-primary; //#fff;
    display: block;
    z-index: 100;
    background: url(../images/status-info.png) rgba(237, 241, 242, .95) no-repeat 100% 5%;
    left: 0px;
    margin: 10px;
    width: 280px;
    position: absolute;
    top: 10px;
    text-decoration: none;
}

.disabled {
  pointer-events: none;
  opacity: 0.8;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>expense_sheet_deparment</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Expense Sheet - Listing My Department</name>
        <option_schema>[{"name":"","section":"other","label":"","type":"string"}]</option_schema>
        <public>false</public>
        <roles>snc_internal,sn_esm_user</roles>
        <script><![CDATA[(function() {
	
	var isApproverUser = false;
	var isApproverDelegate = false;
	var sUserDelegate = '';
	var user = new GlideRecord('sys_user');
	if(user.get(gs.getUserID())){
		isApproverUser = user.u_expense_approver;
	}
	
	var userDelegate = new GlideRecord('sys_user_delegate');
	userDelegate.addEncodedQuery("delegate="+gs.getUserID()+"^u_expense_approval=true^ends>=javascript:gs.beginningOfToday()");
	userDelegate.setLimit(1);
	userDelegate.query();
	while (userDelegate.next()) {
		isApproverDelegate = userDelegate.u_expense_approval;
		sUserDelegate =  userDelegate.user;
	}
//console.log('isApproverDelegate: ' +  isApproverDelegate);
//console.log('isApproverUser: ' +  isApproverUser);
//console.log('sUserDelegate: '+ sUserDelegate);

	data.userId=gs.getUserID();
	data.isApprover = isApproverUser || isApproverDelegate;
	
	var gDate = new GlideDate();
	data.nowDate = new GlideDateTime(gDate) + "";
  data.setDisplayAppTeam = '=1';
  data.fields = 'expsheet_sys_id,expline_status,expline_sys_id,expsheet_number,expline_date_expense,expsheet_short_description,expsheet_opened_by,expsheet_requested_for,expsheet_contract,expsheet_category,expline_rubric,expsheet_status,expline_requested_amount,expline_refunded_amount,expsheet_reimbursement_via_funds,expsheet_fund,expline_miscellaneous_account_code,expline_duplicated,expsheet_source';

	data.reqExpSheetId='';
	data.action='';
	data.comment='undefined';
	

	// ******************************************************************
	
	var expParent='';

	if(input && input.reqExpSheetId!='') {
//console.log('input.action: '+input.action);
		if(input.action == 'approve') {
			var scApprove = new GlideRecord('sysapproval_approver');
			scApprove.addQuery("document_id",input.reqExpSheetId);
			if(isApproverDelegate) 
				scApprove.addQuery("approver",sUserDelegate).addOrCondition('approver',gs.getUserID());
			else
				scApprove.addQuery("approver",gs.getUserID());
			scApprove.query();
			while(scApprove.next()) {
				scApprove.state ='approved';
				scApprove.update();
			}
		}	
		 data.reqExplineId='';
		 data.action='';
		 data.comment='';
		}
 
		if(input && input.reqExpSheetId!='') {
			if(input.action == 'reject' && input.comment != 'undefined') {
				var scReject = new GlideRecord('sysapproval_approver');
				scReject.addQuery("document_id",input.reqExpSheetId);
				if(isApproverDelegate)
					scReject.addQuery("approver",sUserDelegate).addOrCondition('approver',gs.getUserID());
				else
					scReject.addQuery("approver",gs.getUserID());
				scReject.query();
				if(scReject.next()) {
					scReject.state ='rejected';
					scReject.comments=input.comment;
					scReject.update();
				}
			}	

			data.reqExplineId='';
			data.action='';
			data.comment='';
			}
	
			// ******************************************************************
			// defined field filter list
			var iMonth=new GlideDateTime().getMonthLocalTime();

	    data.FilterBy = [{name: gs.getMessage("expense.filter.by.expense_date"), index: 0}];
			data.FilterBy.push({name: gs.getMessage("expense.filter.by.expense_request"), index: 1});

						var bPastSixMonths = (iMonth < 6 ? false  : true);
					var sIncludeLastYear = '';
					if(data.selectedIndex==1 && iMonth <2)  sIncludeLastYear = '^ORexpline_date_expense<=javascript:gs.endOfToday()';
					if(data.selectedIndex==2 && iMonth <4)  sIncludeLastYear = '^ORexpline_date_expense<=javascript:gs.endOfToday()';
					if(data.selectedIndex==3 && iMonth <7)  sIncludeLastYear = '^ORexpline_date_expense<=javascript:gs.endOfToday()';
					if(data.selectedIndex==4)  sIncludeLastYear = '^ORexpline_date_expense<=javascript:gs.endOfToday()';
					sIncludeLastYear = '';

	
			var ExpFilter = [{index:0, filter: gs.getMessage("This month"), condition: 'ONThis month@javascript:gs.beginningOfThisMonth()@javascript:gs.endOfThisMonth()'}];
			var filterCondition2 = {index:1, filter: gs.getMessage("Last month"), condition: 'ONLast month@javascript:gs.beginningOfLastMonth()@javascript:gs.endOfLastMonth()'};
			ExpFilter.push(filterCondition2);
			var filterCondition3 = {index:2, filter: gs.getMessage("Last 3 months"), condition: 'ONLast 3 months@javascript:gs.beginningOfLast3Months()@javascript:gs.endOfLast3Months()'};
			ExpFilter.push(filterCondition3);
			var filterCondition4 = {index:3, filter: gs.getMessage("Last 6 months"), condition: 'ONLast 6 months@javascript:gs.beginningOfLast6Months()@javascript:gs.endOfLast6Months()'};
			ExpFilter.push(filterCondition4);
			var filterCondition5 = {index:4, filter: gs.getMessage("Last 12 months"), condition: 'ONLast 12 months@javascript:gs.beginningOfLast12Months()@javascript:gs.endOfLast12Months()'};
			ExpFilter.push(filterCondition5);
			var filterCondition6 = {index:5, filter: gs.getMessage("View all"), condition: '<=javascript:gs.endOfToday()'};
			ExpFilter.push(filterCondition6);
			var ExpFilterSub = ExpFilter;
			var ExpFilterApp = ExpFilter;
			data.exp_ndx_page = 'expndx';
			data.selectedIndex = 5;
			data.userId=gs.getUserID();
			data.selectedIndexField = 0;

			var paramIds='';
			if(input) {
				if(input.fids) paramIds = input.fids;
			}

			var userSelectedFilterField = (paramIds == '' ? data.selectedIndexField  : parseInt(paramIds[paramIds.length-1]));
			data.userSelectedFilterField = userSelectedFilterField;
			for(var z = 0; z < data.FilterBy.length ; z++) {
				if(z == userSelectedFilterField){ 
					data.selectedIndexField = z;
				}	
			}	
			data.userSelectedFilterField = userSelectedFilterField;
	

			var userSelectedFilter = (paramIds == '' ? data.selectedIndex : parseInt(paramIds[paramIds.length-2]));
			data.userSelectedFilter = userSelectedFilter;
			for(var i = 0; i < ExpFilter.length ; i++) {
				if(i == userSelectedFilter){ 
					data.selectedIndex = i;
				}	
			}	
			data.ExpFilter = ExpFilter;
			data.UserselectedFilter=userSelectedFilter;

	
			var fieldFilterSelected = '';
			if(parseInt(data.selectedIndexField) == 0)
				fieldFilterSelected = 'expline_date_expense';
			else if(parseInt(data.selectedIndexField) == 1)
				fieldFilterSelected = 'expsheet_sys_created_on';

			if(input) {
					if (input.keywordsType != null && input.keywordsType != '')
					{
							data.fieldslabels = getFieldLabels(input.keywordsType, '');
					}
					else data.fieldslabels = getFieldLabels('', fieldFilterSelected);
			}

		function getFieldLabels(keywordsType,fieldType) {
		var scApp = new GlideRecord('x_hdvi2_expense_view');
				//Split the field defined by the options
				var tableFields = data.fields.split(',');
				data.tableFields = tableFields;
				var results = [];

				//initialialize table that will be used in the HTML
				data.approved = [];  

			//get approver list			
			  var sDocIdList = '';
				var grSAList = new GlideRecord('sysapproval_approver');
				grSAList.addQuery('state','requested');
			  if(isApproverDelegate)
					grSAList.addQuery('approver',sUserDelegate).addOrCondition('approver',gs.getUserID());
			  else
					grSAList.addQuery('approver',gs.getUserID());
				grSAList.addQuery('source_table','x_hdvi2_expense_sheet');
				grSAList.query();
				while(grSAList.next()) {
					if(sDocIdList=='')
					sDocIdList = ''+grSAList.document_id;
					else sDocIdList += ',' + grSAList.document_id;
				}
//console.log('sDocIdList: ' + sDocIdList);
			// Load data standing for refused expenses
			  if(keywordsType!='') {
					var keywords = input.keywordsRev;	
					var sTest = 'expsheet_number=EXPHVS0000002833^';
					if(isNaN(keywords))
						scApp.addEncodedQuery('expsheet_stage!=^expsheet_stage=training_approval^ORexpsheet_stage=hr_approval^expsheet_status'+data.setDisplayAppTeam+'^expline_active=true^expsheet_active=true^expsheet_numberCONTAINS'+keywords+'^ORexpline_miscellaneous_account_codeLIKE'+keywords+'^ORexpsheet_fund.displayCONTAINS'+keywords+'^ORexpline_rubric.labelCONTAINS'+keywords+'^ORexpsheet_short_descriptionCONTAINS'+keywords+'^ORexpline_date_expenseCONTAINS'+keywords+'^expsheet_sys_idIN'+sDocIdList);
					else
						scApp.addEncodedQuery('expsheet_stage!=^expsheet_stage=training_approval^ORexpsheet_stage=hr_approval^expsheet_status'+data.setDisplayAppTeam+'^expline_active=true^expsheet_active=true^expsheet_numberCONTAINS'+keywords+'^ORexpline_miscellaneous_account_codeLIKE'+keywords+'^ORexpsheet_fund.displayCONTAINS'+keywords+'^ORexpline_rubric.labelCONTAINS'+keywords+'^ORexpsheet_short_descriptionCONTAINS'+keywords+'^ORexpline_date_expenseCONTAINS'+keywords+'^ORexpsheet_total_refunded_amountIN'+keywords+'^expsheet_sys_idIN'+sDocIdList);
				}
				else {
					scApp.addEncodedQuery(fieldType + data.ExpFilter[data.selectedIndex].condition+'^expsheet_stage!=^expsheet_stage=training_approval^ORexpsheet_stage=hr_approval^expsheet_status'+data.setDisplayAppTeam+'^expline_active=true^expsheet_sys_idIN'+sDocIdList);
				}
				scApp.orderByDesc('expline_number');
				scApp.orderByDesc(fieldType);
				scApp.query();

        for(var i = 0; i < tableFields.length ; i++) {
						if(i==1) results.push(scApp.getElement(tableFields[i]).getED().getLabel()+'_line');
						else results.push(scApp.getElement(tableFields[i]).getED().getLabel());    
				}
			
				var iCptTraining = 0;
				var sExpNum = '';
			
				while(scApp.next()) {
					var objApp0 = {};
					var objApp1 = {};
					var bIndic = false;
					
					sExpNum = scApp.getValue('expsheet_number');

					for(var j = 0 ; j < data.tableFields.length ; j++) {
						if(j==12 || j==13) objApp0[data.tableFields[j]] = parseFloat(scApp.getValue(data.tableFields[j])).toFixed(2);
						else if(j==11 || j==14 || j==17) objApp0[data.tableFields[j]] = scApp.getValue(data.tableFields[j]);
						else objApp0[data.tableFields[j]] = scApp.getDisplayValue(data.tableFields[j]);
					}
					
					var ret = AddForDisplay(scApp, objApp0, sDocIdList);
//console.log(objApp0);					
					while(scApp.next()) {
						if(sExpNum != scApp.getValue('expsheet_number')) {
							sExpNum = scApp.getValue('expsheet_number');
							
							objApp1 = {};
							for(var k = 0 ; k < data.tableFields.length ; k++) {
								if(k==12 || k==13) objApp1[data.tableFields[k]] = parseFloat(scApp.getValue(data.tableFields[k])).toFixed(2);
								else if(k==11 || k==14 || k==17) objApp1[data.tableFields[k]] = scApp.getValue(data.tableFields[k]);
								else objApp1[data.tableFields[k]] = scApp.getDisplayValue(data.tableFields[k]);
							}
							var ret2 = AddForDisplay(scApp, objApp1, sDocIdList);
											
							//objApp1 = {};
							bIndic = false;
						}
						else {
							iCptTraining = Object.keys(objApp1).length
							if(iCptTraining != 0) {
								objApp0 = objApp1;
//console.log(objApp0);					
							}
							var sRub = objApp0[data.tableFields[10]] + "";
							objApp0[data.tableFields[10]] = sRub + "<br>" + scApp.getDisplayValue(data.tableFields[10]) ;
							var sMontant = objApp0[data.tableFields[12]] + "";
							objApp0[data.tableFields[12]] = sMontant + "<br>" + parseFloat(scApp.getValue(data.tableFields[12])).toFixed(2) ;
							bIndic = true;
//console.log(objApp0);					
						}
					}
				}	

			return results;
	}
	
	function AddForDisplay(grApp, arrData, DocList) {
		// ******************************************************************
		// if Fund : check if I've approved to remove the expense request
		var bneedApproval = false;
		var grSA = new GlideRecord('sysapproval_approver');
		if(isApproverDelegate)
			grSA.addQuery('approver',sUserDelegate).addOrCondition('approver',gs.getUserID());
		else
			grSA.addQuery('approver',gs.getUserID());
		grSA.addQuery('state','requested');
		grSA.addQuery('document_id',grApp.getValue(data.tableFields[0]));
		grSA.query();
		if(grSA.next()) {
			bneedApproval = true;
		}
		if(bneedApproval && (isLoggedUserApprover(grApp.expsheet_approver) || DocList!='' || grApp.expsheet_approver.indexOf(gs.getUserID())!=-1)) {
			data.approved.push(arrData);
			//if(objApp0 != objApp1) data.approved.push(objApp1);
		}
		
		return true;
	}
	
	// ******************************************************************
	function isLoggedUserApprover(appSysID) {
		var retVal  = false;
		var userDelegate = new GlideRecord('sys_user_delegate');
		userDelegate.addEncodedQuery("userIN"+appSysID+"^ends>=javascript:gs.beginningOfToday()^u_expense_approval=true^delegate="+gs.getUserID());
		userDelegate.setLimit(1);
		userDelegate.query();
		while (userDelegate.next()) {
			retVal = userDelegate.u_expense_approval;
		}
		return retVal;
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>h40009222</sys_created_by>
        <sys_created_on>2021-02-25 14:11:58</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>302aee6d1ba228507f172f4aab4bcb0d</sys_id>
        <sys_mod_count>23</sys_mod_count>
        <sys_name>Expense Sheet - Listing My Department</sys_name>
        <sys_package display_value="Expense Management" source="x_hdvi2_expense">50e8c3d7dbea0090f5e2174b06961954</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Expense Management">50e8c3d7dbea0090f5e2174b06961954</sys_scope>
        <sys_update_name>sp_widget_302aee6d1ba228507f172f4aab4bcb0d</sys_update_name>
        <sys_updated_by>h40009222</sys_updated_by>
        <sys_updated_on>2021-03-08 15:15:36</sys_updated_on>
        <template><![CDATA[<table class="table table-striped table-responsive ng-scope " style=""> 
  <thead>
    <tr class="tr-top">
      <th class="thead text-nowrap ng-binding">
        <div class="th-exp-title ng-binding" aria-label="refresh data">
          <h4 class="panel-title">
            <span id="reloadCircle" class="m-r-sm fa ng-scope fa-refresh" style="padding-bottom: 5px;color: #a6aaab;float: left;zoom: 1.4;" aria-hidden="true" name="reload" role="button" ng-click="c.refreshScreen()">
            </span>
            <span id="reload" style="padding-bottom: 2px;color: black;float: left;" aria-hidden="true" name="reload" role="button" ng-click="c.refreshScreen()">
              ${Refresh this page to see changes ...}
            </span>
          </h4>
        </div>
      </th>
      <th class="thead text-nowrap ng-binding">
        <div class="th-exp-title ng-binding" aria-label="refresh data">
          <h4 class="panel-title">
            <span style="padding-bottom: 2px;color: black;float: left; font-weight: 700;" aria-hidden="true" name="fieldFilterTitle">
               ${Filter by}
            </span>
            <span style="padding-bottom: 2px;color: black;" aria-hidden="true" name="fieldFilter">
    					<select class="panel-heading pointer" style="padding: 0px 0px 0px 2px; border:0px;" ng-change="changeFilterField(selectedFilterBy)" ng-model="selectedFilterBy" id="selectedFilterBy" ng-options="FiltersBy.name for FiltersBy in c.data.FilterBy track by FiltersBy.index"/>
            </span>
          </h4>
        </div>
      </th>
      <th class="thead text-nowrap ng-binding">
        <div class="th-exp-title ng-binding" aria-label="refresh data">
          <h4 class="panel-title">
            <span style="padding-bottom: 2px;color: black;float: left; font-weight: 700;" aria-hidden="true" name="periodFilterTitle">
               ${Select Period}
            </span>
            <span style="padding-bottom: 2px;color: black;" aria-hidden="true" name="periodfilter">
  							<select class="panel-heading pointer" style="padding: 0px 0px 0px 2px; border:0px;" ng-change="changeFilter(selectedFilter)" ng-model="selectedFilter" id="selectedFilter" ng-options="Filters.filter for Filters in c.data.ExpFilter track by Filters.index"/>
            </span>
          </h4>
        </div>
      </th>
      <th class="thead text-nowrap ng-binding">
        <div class="th-exp-title ng-binding" aria-label="refresh data">
          <h4 class="panel-title">
            <span style="padding-bottom: 2px;color: black;float: left; font-weight: 700;" aria-hidden="true" name="searchFilterTitle">
               ${Search per keywords}
            </span>
            <span style="padding-bottom: 2px;color: black;" aria-hidden="true" name="periodfilter">
                  <input class="thead" id="keywordsRev" style="display: flex; padding-left: 5px; height: 23px; border:1px solid $panel-default-heading-bg;" type="text" ng-model="keywordsRev" ng-change="findKeywords('rev',this.keywordsRev)" ng-model-options="{debounce: 250}">
            </span>
          </h4>
        </div>
      </th>
    </tr>
  </thead>
</table>

<div class="pointer ng-binding ng-scope" style="display:none;">
  <textarea ng-model="comment" maxlength="1024"></textarea>
  <input type="text" ng-model="reqExpSheetId">
  <input type="text" ng-model="action" value="">
  <input type="text" ng-model="setDisplayAppTeam">
</div>
<p/>
<div ng-if="data.isApprover" class="container">
 <div class="clearfix"></div>
 <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
   <div class="panel panel-default">
      <div class="panel-heading" role="tab" id="headingOne">
          <div class="collapsed" data-toggle="collapse" data-parent="#accordion" aria-expanded="true" aria-controls="collapseOne">
            <h4 class="panel-title">
              <span class="panel-title" style="display: flex;">${expense.label.expense.approval.pending}
              </span>   
      		</h4>
        </div>
      </div>
      <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel expense-panel-primary">
          <div class="panel-body">
          <p>
          </p>
          <div  ng-if="data.approved.length > 0" >
            <table class="table table-striped table-responsive ng-scope" style=""> 
              <thead>
                <tr class="tr-top">
                  <th ng-if="$index!=17 && $index!=13 && $index!=8 && $index!=9 && $index!=18 && $index!=14 && $index!=15 && $index!=16 && labels!='Sys ID' && labels!='Status' && labels!='Status_line' && labels!='Statut_line' && labels!='Statut'" class="thead text-nowrap ng-binding disabled" ng-repeat="labels in c.data.fieldslabels track by $index" ng-click="setOrderBy(labels)" tabindex="0">
                    <div class="th-exp-title ng-binding" aria-label="Sort by  {{labels}}">
                      {{labels}}
                    </div>
                  </th>
                </tr>
              </thead>
              <tr ng-repeat="record in data.approved track by $index" class="doublon-{{record['expline_duplicated']}}">
                <td ng-if="$index!=2 && $index!=11 && $index!=1 && $index!=0 && $index!=17 && $index!=13 && $index!=8 && $index!=9 && $index!=18 && $index!=14 && $index!=15 && $index!=16" ng-repeat="field in data.tableFields track by $index" tabindex="0" class="disabled">
                  <div ng-if="field=='expsheet_number' && field!='expsheet_sys_id' && field!='expline_requested_amount'" class="pointer sp-list-cell ng-binding ng-scope">
                    {{record[field]}}&nbsp;<i ng-if="record['expline_duplicated']==1" class="fa fa-question-circle tip" style="pointer-events: auto;font-size:16px;color:#ff5200;" title=""><span>${expense.duplicates.warning}</span></i>
                  </div>
                  <div ng-if="$index!=9">
                    <div ng-if="$index!=5">
                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && record['expsheet_reimbursement_via_funds']==0 && record['expline_rubric']!='Divers'" class="sp-list-cell ng-binding ng-scope">
                        <span ng-bind-html="record[field]">{{record[field]}}</span>
                      </div>
                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && $index==10 && record['expline_miscellaneous_account_code']!='' && record['expline_rubric']=='Divers' && record['expsheet_reimbursement_via_funds']==1" class="sp-list-cell ng-binding ng-scope">
                        {{record[field]}}<span style="font-weight: 700;"><br>{{record['expline_miscellaneous_account_code']}}<br>{{c.data.fieldslabels[15]}}: {{record['expsheet_fund']}}</span>
                      </div>
                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && $index==10 && record['expline_miscellaneous_account_code']=='' && record['expline_rubric']=='Divers' && record['expsheet_reimbursement_via_funds']==1" class="sp-list-cell ng-binding ng-scope">
                        {{record[field]}}<span style="font-weight: 700;"><br>{{c.data.fieldslabels[15]}}: {{record['expsheet_fund']}}</span>
                      </div>
                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && $index==10 && record['expline_rubric']!== 'Divers' && record['expsheet_reimbursement_via_funds']==1" class="sp-list-cell ng-binding ng-scope">
                        {{record[field]}}<span style="font-weight: 700;"><br>{{c.data.fieldslabels[15]}}: {{record['expsheet_fund']}}</span>
                      </div>
                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && $index==10 && record['expline_miscellaneous_account_code']!=='' && record['expline_rubric']== 'Divers' && record['expsheet_reimbursement_via_funds']!=1" class="sp-list-cell ng-binding ng-scope">
                        {{record[field]}}<span style="font-weight: 700;"><br>{{record['expline_miscellaneous_account_code']}}</span>
                      </div>

                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && $index!=10  && record['expline_rubric']=='Divers'" class="sp-list-cell ng-binding ng-scope">
                        {{record[field]}}
                      </div>
                    
                      <div ng-if="$index!=0 && $index!=3 && $index!=12 && $index!=10 && record['expsheet_reimbursement_via_funds']==1 && record['expline_rubric']!='Divers'" class="sp-list-cell ng-binding ng-scope">
                        {{record[field]}}
                      </div>

                      <div ng-if="$index==12" class="sp-list-cell ng-binding ng-scope" style="float:right;">
                        <span ng-bind-html="record[field]">{{record[field]}}</span>
                      </div>
                    </div>
                    <div ng-if="$index==5" style="width: 75%;">
                        {{record[field]}}<p ng-if="record['expsheet_source']!=''">{{record['expsheet_source']}}</p>
                    </div>
                  </div>
                </td>
                <td class="td-alignmiddle">
                  <div class="pointer ng-binding ng-scope">
                    <i class="fa fa-eye" name="viewonly" id="viewonly" style="font-size:26px;color:#0089ff;" ng-click="c.onWidgetOnly(record['expline_sys_id'],record['expsheet_category'])" title="${expense.view_only.request}" role="button"></i>
                  </div>
                </td>
                <td class="td-alignmiddle" >
                  <div ng-if="record['expsheet_status']==1" class="pointer ng-binding ng-scope">
                    <img class ="td_img" name="approve" src="hvs_approve_expense.svg" alt="${expense.approve.request}" title="${expense.approve.request}" align="middle" role="button" ng-click="c.SetApprovalExpense(record['expsheet_sys_id'],'approve')">
                  </div>
                </td>
                <td class="td-alignmiddle">
                  <div ng-if="record['expsheet_status']==1" class="pointer ng-binding ng-scope">
                    <img class ="td_img" name="reject" src="hvs_reject_expense.svg" alt="${expense.reject.request}"  title="${expense.reject.request}" align="middle" role="button" ng-click="c.SetApprovalExpense(record['expsheet_sys_id'],'reject')">
                  </div>
                </td>
                </tr>
            </table>
          </div>  
          <div  ng-if="data.approved.length == 0" >
              <table class="table table-striped table-responsive ng-scope" ng-if="c.data.records.length == 0" style="">
                <thead>
                  ${expense.label.expense.no_expense.approve}
                </thead>
              </table>  
          </div>  
        </div>
      </div>
    </div>
    </div>
    <!-- ***************************************************** -->  
</div>
</div>  
<script type="text/ng-template" id="filter-template.html">
  <select class="panel-heading" style="padding: 0px 0px 0px 10px;" ng-change="changeFilter(selectedFilter)" ng-model="selectedFilter" id="selectedFilter" ng-options="Filters.filter for Filters in c.data.ExpFilter track by Filters.index"/>
</script>
]]></template>
    </sp_widget>
</record_update>
